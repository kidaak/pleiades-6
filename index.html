<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb" >
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
        <title></title>
        <style type="text/css">
html {
  background: #C7C289;
  overflow: hidden;
}

#ticket {
  position: absolute;
  bottom: 10px;
  right: 20px;
  font-family: sans-serif;
  font-weight: bold;
  font-style: italic;
  z-index: 1;
  font-size: 20px;
  background: none;
  border: none;
  text-align: center;
}

#ticket:focus {
  background: white;
}
        </style>
    </head>
    <body>
        <input id="ticket" type="text" size="4"/>
        <script src="lib/raphael.js"></script>
        <script src="lib/seedrandom.js"></script>
        <script src="pleiades.js"></script>

        <script src="jasmine-standalone-1.3.1/lib/jasmine-1.3.1/jasmine.js"></script>
        <script src="test.js"></script>
<script>

var generator = new pl.Generator(),
    composition,
    ticket,
    brush = new pl.RaphaelBrush(),
    running = true;

brush.init();

var zoomLevel = 0,
    zoomSpeed = 5;

function zoom() {
  zoomLevel++;
  window.requestAnimFrame(zoom);
  brush.paper.setViewBox(
    zoomLevel * zoomSpeed,
    zoomLevel * zoomSpeed,
    window.innerWidth - zoomLevel * 2 * zoomSpeed,
    window.innerHeight - zoomLevel * 2 * zoomSpeed,
    true
  );
}

function refresh() {
  var ticketInput = document.getElementById('ticket');
  setTimeout(refresh, 2000);
  if (document.body.className !== 'hidden' && running) {
    ticket = pl.util.makeTicket();
    SeedRandom.seed(ticket);
    composition = generator.make();
    zoomLevel = 0;
    brush.drawComposition(composition);
    ticketInput.value = ticket;
  }
}

document.getElementById('ticket')
  .addEventListener('focus', function() {
    running = false;
  });

document.getElementById('ticket')
  .addEventListener('blur', function() {
    running = true;
  });

document.getElementById('ticket')
  .addEventListener('keypress', function(e) {
    if (!e) e = window.event;
    var keyCode = e.keyCode || e.which;
    if (keyCode === 13) {
      var value = this.value.trim();
      if (value.length === 4 && value !== ticket) {
        ticket = value;
        SeedRandom.seed(ticket);
        composition = generator.make();
        brush.drawComposition(composition);
      }}
  });

(function () {
  SeedRandom.seed('test');
  composition = generator.make();
  brush.drawComposition(composition);
} ());

// refresh();
// Uncomment on a fast machine
// zoom();
</script>
    </body>
</html>
