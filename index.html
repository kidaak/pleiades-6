<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb" >
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
        <title></title>
        <style type="text/css">
html {
  background: #C7C289;
  overflow: hidden;
}

#ticket {
  position: absolute;
  bottom: 10px;
  right: 20px;
  font-family: sans-serif;
  font-weight: bold;
  font-style: italic;
  z-index: 1;
  font-size: 20px;
  background: none;
  border: none;
  text-align: center;
}

#ticket:focus {
  background: white;
}
        </style>
    </head>
    <body>
        <input id="ticket" type="text" size="4"/>
        <script src="lib/raphael.js"></script>
        <script src="lib/seedrandom.js"></script>
        <script src="pleiades.js"></script>

<script>

var generator, composition, ticket, brush, stampFactory;
// pl.debug = true;

function initUI() {
  document.getElementById('ticket')
  .addEventListener('focus', function() {
    previewer.paused = true;
  });

document.getElementById('ticket')
  .addEventListener('blur', function() {
    previewer.paused = false;
  });

document.getElementById('ticket')
  .addEventListener('keypress', function(e) {
    if (!e) e = window.event;
    var keyCode = e.keyCode || e.which;
    if (keyCode === 13) {
      var value = this.value.trim();
      if (value.length === 4 && value !== ticket) {
        ticket = value;
        previewer.step(value);
      }}
  });
}

var previewer;
function init(type) {
  initUI();
  window.tmp = SeedRandom.getState();
  var colorThemeFactory = new pl.ColorThemeFactory(),
      stampFactory = new pl.StampFactory(colorThemeFactory);
  previewer = new pl.Previewer({
    colorThemeFactory: colorThemeFactory,
    painter: new pl.RaphaelPainter(),
    loopInterval: 0.5,
    // beforeStepHook: function() {
    // var ticketInput = document.getElementById('ticket');
    // this.ticket = pl.util.makeTicket();
    // },
    afterStepHook: function() {
      document.getElementById('ticket').value = previewer.ticket;
    },
    compositionFactory: new pl.CompositionFactory({
      depth: 4,
      sequenceLength: 15,
      stampFactory: stampFactory,
      colorThemeFactory: colorThemeFactory
    })
  });
  previewer.start(type === undefined ? 'loop' : type);
}

init('loop');

</script>
    </body>
</html>
