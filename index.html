<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb" >
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
        <title></title>
        <style type="text/css">
html {
  background: #C7C289;
  overflow: hidden;
}

#ticket {
  position: absolute;
  bottom: 10px;
  right: 20px;
  font-family: sans-serif;
  font-weight: bold;
  font-style: italic;
  z-index: 1;
  font-size: 20px;
  background: none;
  border: none;
  text-align: center;
}

#ticket:focus {
  background: white;
}
        </style>
    </head>
    <body>
        <input id="ticket" type="text" size="4"/>
        <script src="lib/raphael.js"></script>
        <script src="lib/seedrandom.js"></script>
        <script src="pleiades.js"></script>

<script>

var generator, composition, ticket, brush,
    running = true;
// pl.debug = true;

function refresh() {
  var ticketInput = document.getElementById('ticket');
  if (document.body.className !== 'hidden' && running) {
    while (true) {
      ticket = pl.util.makeTicket();
      SeedRandom.seed(ticket);
      if (step()) {
        ticketInput.value = ticket;
        break;
      }
    }
  }
  setTimeout(refresh, 6000);
}

function initUI() {
  document.getElementById('ticket')
  .addEventListener('focus', function() {
    running = false;
  });

document.getElementById('ticket')
  .addEventListener('blur', function() {
    running = true;
  });

document.getElementById('ticket')
  .addEventListener('keypress', function(e) {
    if (!e) e = window.event;
    var keyCode = e.keyCode || e.which;
    if (keyCode === 13) {
      var value = this.value.trim();
      if (value.length === 4 && value !== ticket) {
        ticket = value;
        SeedRandom.seed(ticket);
        composition = generator.make();
        brush.drawComposition(composition);
      }}
  });
}

function init() {
  initUI();
  brush = new pl.RaphaelPainter();
  brush.init();
  generator = new pl.CompositionFactory()
  // brush._showBoundingBox = true;
}

function step() {
  // SeedRandom.seed('4D30'); // invisible
  // SeedRandom.seed('1421'); // small
  // SeedRandom.seed('189E');
  // brush.angleRotation = 0.1;
  composition = generator.make();
  return brush.drawComposition(composition);
}

switch (2) {
case 1:
  SeedRandom.seed('test');
  init();
  step();
  break;

case 2:
  init();
  refresh();
  break;

case 0:
  break;

default:
  init();
}

// test_angleRotator()

</script>
    </body>
</html>
